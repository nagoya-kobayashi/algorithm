# 探索ゲーム（探索アルゴリズム体験教材）— 要件定義（ラウンド1〜4）

## 前提（利用者、端末、ネットワーク、運用）
### 利用者
- 生徒：プレイ（クリック操作、結果閲覧）
- 教員：授業進行、ログの回収・分析、ランキング確認

### 端末・ブラウザ
- 学校端末（Windows / Chrome想定）
- 追加ソフト不要（ブラウザのみで動作）

### ネットワーク
- 同一オリジン（教材WebとPerl CGIが同一ホスト配下）を基本とする
- CORSを前提にしない（学校環境で詰まりやすいため）

### 運用
- 授業前に教材一式を所定サーバに配置
- 名簿対応表（ユーザID→年組番氏名）をサーバ側に配置

---

## ユースケース（生徒／教員）
### 生徒
- UC-S1：タイトル画面から開始し、未クリアのラウンドをプレイする
- UC-S2：クリア後、全データが開示され、未クリック行が青字で示される
- UC-S3：クリア前でも同じクラスのランキング（全員）を見る
- UC-S4：ラウンド4の結果画面で全ラウンドのランキングを確認する

### 教員
- UC-T1：授業でラウンドの意図（探索手順の違い）を説明する
- UC-T2：ログファイルを回収し、探索回数／時間の集計を行う
- UC-T3：授業中にランキングが動くことで参加意欲を維持する

---

## 必須要件／推奨要件（Must / Should）
### Must（必須）
- M1：最初にタイトル画面を表示し、「はじめる」クリックで開始する
- M2：ユーザIDのクリア記録を確認し、未クリアの最小ラウンドから開始する
- M3：各ラウンド開始時に開始演出（ラウンド名降下、アルゴリズム名・タスク文字の跳ね出し、画像出現→フェードアウト）を表示する
- M4：名簿データを表形式で表示できる（初期は枠と連番のみ、ラウンド2のみインデクス列を表示）
- M5：未クリック行のクリックでデータが表示され、探索回数が1増える（クリック済み行は回数を増やさない）
- M6：正解人物の行を表示した瞬間にクリア判定される
- M7：クリアタイムは「最初のクリック」〜「クリアクリック」まで
- M8：クリア時に「ユーザID・ラウンドNo・探索回数・クリアタイム」をサーバへ送信
- M9：サーバはユーザIDを「年・組・番・氏名」に変換し、ログに追記保存する
- M10：クリア後に全名簿データを表示し、未クリック行を青字にする
- M11：クリア後は表クリックを無効にする
- M12：ユーザID確定後に同一クラスのベストスコア（user_idごとに最良記録、クリアタイム昇順／同タイムなら探索回数昇順）を全員表示する（クリア不要）
- M13：2秒おきにランキング取得を継続する（10位が揃っても停止しない）
- M14：ランキングが10件以上の時点で次ラウンドのボタンのみ活性化する（クリア不要、前後ラウンドは非活性のまま）
- M15：ブラウザの戻るボタンで画面状態が変化しない
- M16：ラウンド4のリザルト右下に「結果画面にいく」を表示する
- M17：結果画面でラウンド1〜4のランキングを全て表示し、1秒おきに更新する

### Should（推奨）
- S1：ユーザIDの入力を1回で済ませ、再訪時は保存（localStorage等）
- S2：通信失敗時も授業が止まらない（ローカル表示は継続、送信リトライ案内）
- S3：student.csv の更新だけで名簿が反映される構造にする（roster.js は読み込み・抽出のみ）
- S4：操作の説明は必要に応じて表示し、常時表示は必須としない
- S5：アクセシビリティ（キーボード操作、視認性）に配慮する

---

## 非機能要件（性能、可用性、保守性、データ保持）
### 性能
- 表示対象：40行程度（1クラス想定）で快適に動作
- ランキング取得：ゲーム画面は2秒間隔、結果画面は1秒間隔でもサーバ負荷が軽い実装（ログ全走査でも許容だが将来改善余地）

### 可用性
- ランキング通信が失敗してもゲーム本体は成立する
- 送信失敗時は再送導線（ボタン／自動再送）を用意（推奨）

### 保守性
- 画面・機能IDはドキュメント上は日本語の正式名称を使用
- データファイル（名簿）とロジック（ゲーム処理）を分離する

### データ保持
- ログは追記型（TSV/CSV）で保存
- 保存期間は年度運用に合わせて設定（未確定）

---

## 制約条件（学校環境・運用）
- 学校ネットワークの制約（フィルタ・TLS・ポート制限）により外部通信は想定しない
- 個人情報は必要最小限：クライアントから氏名を送らず、サーバ側で名簿変換する
- 教員以外がログに直接アクセスできない配置・権限が必要

---

## 未確定事項リスト（初版）
- 名簿データの範囲（1クラスのみ／学年全体）
- 送信失敗時の扱い（授業中は無視／手動再送／裏で自動再送）
- ランキング表示名の匿名化レベル（現行は「番＋氏名（フルネーム）」、本番運用時に要検討）
