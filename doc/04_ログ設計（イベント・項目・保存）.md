# 探索ゲーム（探索アルゴリズム体験教材）— ログ設計（イベント・項目・保存）（ラウンド1〜4）

## ログ設計方針（最小限の個人情報、粒度、目的）
- クライアントから氏名は送らない（個人情報最小化）
- 送信は「クリア時のみ」の最小構成（授業運用の安定性優先）
- サーバ側でユーザIDを名簿対応表により「年・組・番・氏名」へ変換して保存
- 目的：
  - ランキング表示（授業中の動機づけ）
  - 授業後の集計（探索回数・時間の分布）
  - 教材改善（ラウンド間比較の基礎データ）

---

## ログイベント一覧（正式名称、発火条件、必須項目、任意項目）
### 1) クリア結果ログ（必須）
- 正式名称：クリア結果ログ
- 発火条件：正解行クリックでクリアした瞬間
- 必須項目：
  - サーバ受信日時（JST）
  - 年、組、番、氏名（サーバ側変換）
  - ユーザID（受信値）
  - ラウンドNo
  - 探索回数
  - クリアタイム（ms）
- 任意項目（推奨）：なし

（将来案）
### 2) クリックログ（任意・未実装）
- 発火条件：行クリック毎
- 粒度が細かくなり、個人情報や保存量が増えるため慎重に判断

---

## ログ項目定義（型、制約、例、マスキング/匿名化）
### 必須項目
- 受信日時（JST）
  - 型：文字列
  - 例：2026-01-09 16:30:12.345
- 年／組／番
  - 型：整数
  - 例：1 / 1 / 17
- 氏名
  - 型：文字列
  - 例：小林 裕司
  - 注意：ログ閲覧権限を教員に限定
- ユーザID
  - 型：文字列（最大32推奨）
  - 例：1-1-17 / g12345 など
- ラウンドNo
  - 型：整数（1〜4）
- 探索回数
  - 型：整数（1以上）
- クリアタイムms
  - 型：整数（0以上）

### マスキング/匿名化（必要なら）
- 研究利用時は氏名を除外し、番＋クラス程度にする
- ランキング表示は「番＋氏名（フルネーム）」で表示（現行）

---

## 保存形式とローテーション（保存期間）
### 保存形式（推奨：TSV）
- ファイル例：search_game_results.tsv（CGIと同一フォルダ）
- 1行1レコード（追記）
- タブ区切り（TSV）で、Excel取り込みが容易
- 先頭行にヘッダ行を付与（列名）

列例：
受信日時	年	組	番	ユーザID	氏名	ラウンドNo	探索回数	クリアタイムms

### ローテーション
- 期間：学期／年度でファイルを分ける（未確定）
- バックアップ：授業実施日ごとにコピー（運用で対応）

---

## 分析・可視化の想定（授業／研究）
- 探索回数のヒストグラム（ラウンド1）
- クリアタイムの分布（端末差／操作差）
- ラウンド間比較（2〜4実装後）
- ランキング推移（授業中の盛り上がり観察）

---

## 未確定事項リスト（初版）
- ログ保存期間（年度末までか、短期で削除か）
- ランキング表示名の匿名化レベル（本番運用時に要再検討）
- User-AgentやIPを保存するか（学校の個人情報方針に合わせる）
