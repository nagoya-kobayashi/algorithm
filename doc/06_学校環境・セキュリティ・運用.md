# 探索ゲーム（探索アルゴリズム体験教材）— 学校環境・セキュリティ・運用（ラウンド1〜4）

## 学校環境の制約（ネットワーク、端末、ブラウザ）
- 端末：学校PC（Windows）・Chrome想定
- ネットワーク：校内サーバ配信を基本（外部通信なし）
- フィルタ：i-Filter等により外部APIやCORSが詰まりやすい  
  → **同一オリジン構成**（WebとCGIを同一ホスト配下）を推奨
- HTTPS：校内サーバのTLS事情に依存（HTTPでも動く設計。ただし混在は避ける）

---

## セキュリティ要件（入力検証、XSS/CSRF、認証、アクセス制御）
### 入力検証
- CGI側で必須項目・型・範囲チェックを必ず行う
- user_idは許可文字を限定する（推奨：英数-_.）

### XSS
- ランキング返却のdisplay_nameはエスケープしてHTMLに出す（JS側でも注意）
- 名簿データは教材側で固定（外部入力ではない）だが、表示時は過信しない

### CSRF
- 校内限定であっても、ログ受信エンドポイントはPOSTを基本
- 可能なら簡易トークン（教材に埋め込み）も検討（未確定）

### 認証・アクセス制御
- CGIやログファイルへの直接アクセスは教員のみ（サーバ設定で制限）
- 生徒は「ゲーム画面」だけ到達できればよい
- ゲーム開始は student.csv に存在する user_id のみ許可（簡易的な照合）

---

## 個人情報の扱い（収集範囲、保存期間、閲覧権限、持ち出し）
- クライアント送信は最小：user_id / round_no / search_count / clear_time_ms
- 氏名はサーバ側で付与してログに保存（ログ閲覧は教員のみ）
- ランキング表示名は「番＋氏名（フルネーム）」を使用（現行）
- 保存期間：授業目的達成に必要な期間（学期・年度）に限定（未確定）
- 研究利用する場合は匿名化（番＋クラス等）してから持ち出す

---

## 運用手順（配置、権限、バックアップ、障害対応）
### 配置
1. /algorithm/ 直下にHTML/CSS/JSとPerl CGIを配置（実行権限付与）
2. /algorithm/search_game_results.tsv に書き込み可能な権限を付与（Webから直アクセス不可にする）
3. student.csv を /algorithm/ 直下に配置
4. 本番運用では /cgi-bin/ と /logs/ へ分離し、アクセス制限を強化する

### バックアップ
- 授業実施日の終わりに logs/ を別場所へコピー（運用で十分）

### 障害対応
- ランキングが取れない：授業は継続可能（ランキング表示を諦める）
- ログが書けない：授業後の集計ができないため、早めに復旧（権限・容量確認）

---

## 説明責任のための記録（何を集め、何に使うか）
- 生徒への説明（例）：
  - 「探索回数と時間だけを記録し、授業の振り返りとランキングに使います」
  - 「氏名は画面からは送らず、学校内でのみ扱います」
- 教員側の記録：
  - 収集項目、保存期間、閲覧権限、削除手順を文書化

---

## 未確定事項リスト（初版）
- 学校サーバの権限設定（生徒からログにアクセスできない担保）
- HTTPS必須か（混在でfetchが止まる環境があるか）
- 名簿対応表の保管場所（アクセス権・バックアップ）
